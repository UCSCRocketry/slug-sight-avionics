<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slug Sight Ground Station</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4ecca3;
        }
        
        .stat-label {
            color: #999;
            margin-top: 5px;
        }
        
        .telemetry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .telemetry-card {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4ecca3;
        }
        
        .telemetry-card h3 {
            margin-bottom: 15px;
            color: #4ecca3;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #0f3460;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #999;
        }
        
        .data-value {
            font-weight: bold;
            color: #eee;
        }
        
        .state-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .state-PAD { background: #6c757d; }
        .state-BOOST { background: #28a745; }
        .state-COAST { background: #ffc107; color: #000; }
        .state-DESCENT { background: #17a2b8; }
        .state-LANDED { background: #dc3545; }
        
        #chart-container {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            min-height: 400px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸš€ SLUG SIGHT AVIONICS</h1>
        <p>UCSC Rocket Team - Ground Data System</p>
    </div>
    
    <div class="status-bar">
        <div class="stat-box">
            <div class="stat-value" id="packet-count">0</div>
            <div class="stat-label">Packets Received</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="packet-rate">0.0</div>
            <div class="stat-label">Packets/sec</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="uptime">00:00</div>
            <div class="stat-label">Uptime</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="rssi">0</div>
            <div class="stat-label">RSSI (dBm)</div>
        </div>
    </div>
    
    <div class="telemetry-grid">
        <!-- Flight State -->
        <div class="telemetry-card">
            <h3>Flight State</h3>
            <div style="text-align: center; padding: 20px;">
                <span class="state-indicator state-PAD" id="flight-state">WAITING...</span>
            </div>
            <div class="data-row">
                <span class="data-label">Packet #</span>
                <span class="data-value" id="packet-num">0</span>
            </div>
            <div class="data-row">
                <span class="data-label">Timestamp</span>
                <span class="data-value" id="timestamp">0.000s</span>
            </div>
        </div>
        
        <!-- Altitude & Pressure -->
        <div class="telemetry-card">
            <h3>Barometer (BMP280)</h3>
            <div class="data-row">
                <span class="data-label">Altitude</span>
                <span class="data-value" id="altitude">0.0 m</span>
            </div>
            <div class="data-row">
                <span class="data-label">Pressure</span>
                <span class="data-value" id="pressure">0 Pa</span>
            </div>
            <div class="data-row">
                <span class="data-label">Temperature</span>
                <span class="data-value" id="temperature">0.0 Â°C</span>
            </div>
        </div>
        
        <!-- IMU -->
        <div class="telemetry-card">
            <h3>IMU (LSM6DSOX)</h3>
            <div class="data-row">
                <span class="data-label">Accel X/Y/Z</span>
                <span class="data-value" id="accel">0.0, 0.0, 0.0 m/sÂ²</span>
            </div>
            <div class="data-row">
                <span class="data-label">Gyro X/Y/Z</span>
                <span class="data-value" id="gyro">0.0, 0.0, 0.0 Â°/s</span>
            </div>
        </div>
        
        <!-- Magnetometer -->
        <div class="telemetry-card">
            <h3>Magnetometer (LIS3MDL)</h3>
            <div class="data-row">
                <span class="data-label">Mag X/Y/Z</span>
                <span class="data-value" id="mag">0.0, 0.0, 0.0 Î¼T</span>
            </div>
        </div>
        
        <!-- GPS -->
        <div class="telemetry-card">
            <h3>GPS</h3>
            <div class="data-row">
                <span class="data-label">Latitude</span>
                <span class="data-value" id="gps-lat">0.000000Â°</span>
            </div>
            <div class="data-row">
                <span class="data-label">Longitude</span>
                <span class="data-value" id="gps-lon">0.000000Â°</span>
            </div>
            <div class="data-row">
                <span class="data-label">Altitude</span>
                <span class="data-value" id="gps-alt">0.0 m</span>
            </div>
            <div class="data-row">
                <span class="data-label">Satellites</span>
                <span class="data-value" id="gps-sats">0</span>
            </div>
        </div>
    </div>
    
    <div id="chart-container">
        <h3>Altitude Chart (Coming Soon)</h3>
        <p style="color: #666; padding: 20px;">Real-time altitude chart will appear here</p>
    </div>
    
    <div class="footer">
        <p>UCSC Rocket Team &copy; 2025 | Slug Sight Avionics v2.0</p>
    </div>
    
    <script>
        // Update telemetry every 100ms
        setInterval(updateTelemetry, 100);
        setInterval(updateStats, 1000);
        
        function updateTelemetry() {
            fetch('/api/telemetry/latest')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'waiting') return;
                    
                    // Flight state
                    const stateEl = document.getElementById('flight-state');
                    stateEl.textContent = data.state || 'UNKNOWN';
                    stateEl.className = 'state-indicator state-' + (data.state || 'PAD');
                    
                    // Packet info
                    document.getElementById('packet-num').textContent = data.packet_num || 0;
                    document.getElementById('timestamp').textContent = (data.timestamp || 0).toFixed(3) + 's';
                    
                    // Barometer
                    document.getElementById('altitude').textContent = (data.altitude || 0).toFixed(1) + ' m';
                    document.getElementById('pressure').textContent = Math.round(data.pressure || 0) + ' Pa';
                    document.getElementById('temperature').textContent = (data.temperature || 0).toFixed(1) + ' Â°C';
                    
                    // IMU
                    document.getElementById('accel').textContent = 
                        `${(data.accel_x || 0).toFixed(2)}, ${(data.accel_y || 0).toFixed(2)}, ${(data.accel_z || 0).toFixed(2)} m/sÂ²`;
                    document.getElementById('gyro').textContent = 
                        `${(data.gyro_x || 0).toFixed(1)}, ${(data.gyro_y || 0).toFixed(1)}, ${(data.gyro_z || 0).toFixed(1)} Â°/s`;
                    
                    // Magnetometer
                    document.getElementById('mag').textContent = 
                        `${(data.mag_x || 0).toFixed(1)}, ${(data.mag_y || 0).toFixed(1)}, ${(data.mag_z || 0).toFixed(1)} Î¼T`;
                    
                    // GPS
                    document.getElementById('gps-lat').textContent = (data.gps_lat || 0).toFixed(6) + 'Â°';
                    document.getElementById('gps-lon').textContent = (data.gps_lon || 0).toFixed(6) + 'Â°';
                    document.getElementById('gps-alt').textContent = (data.gps_alt || 0).toFixed(1) + ' m';
                    document.getElementById('gps-sats').textContent = data.gps_satellites || 0;
                    
                    // RSSI
                    document.getElementById('rssi').textContent = data.ground_rssi || 0;
                })
                .catch(err => console.error('Error fetching telemetry:', err));
        }
        
        function updateStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('packet-count').textContent = data.packet_count || 0;
                    document.getElementById('packet-rate').textContent = (data.packet_rate || 0).toFixed(1);
                    
                    // Format uptime as MM:SS
                    const uptime = data.elapsed_time || 0;
                    const mins = Math.floor(uptime / 60);
                    const secs = Math.floor(uptime % 60);
                    document.getElementById('uptime').textContent = 
                        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                })
                .catch(err => console.error('Error fetching stats:', err));
        }
    </script>
</body>
</html>
